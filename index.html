<!DOCTYPE html>
<!-- saved from url: http://gadget.buddyspike.net/ -->
<html lang="en">
	<head>
		<title>operation:BLUE FLAG</title>
		
		<meta name="description" content="24/7 DCS Multiplayer Campaign">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="msapplication-config" content="none"> <!--something with windows 8-->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		
		<!--BOOTSTRAP-->
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
		<!--SOCKET IO-->
		<script src="static/socket.io-1.4.5.js"></script>
		
		
		
		<!--MAIN STYLESHEET-->
		<style>
			body {
				width: 100%;
				min-width: 990px;
				
				text-align: center;
				
				background-color: #000;
				
				overflow-y: scroll;
			}
			
			.tooltip-inner {
				white-space: pre;
				max-width: none;
				font-size: 14px;
			}
			
			
			
			#header {
				text-align: right;
				width: 100%;
				background: #404040;
				padding: 6px;
				color: #aaaaaa;
			}
			
			#contentContainer {
				width: 990px;
				padding: 5px;
				margin: 0 auto;
			}
			
			#mainContent {
				margin: 0 auto;
			}
			
			#map {
				width: 800px;
				position: relative;
				margin: 0 auto;
			}
			
			.basesList {
				width: 250px;
				
				background: #000;
			}
			
			.basesList h5 {
				text-align: left;
				color:white;
				font-weight: bold;
			}
			
			
			
			.bsspacing {
				line-height: 1.1;
				color: lightgray;
			}
			
			ul.no_bullet {
				list-style-type: none;
				padding: 0;
				margin: 20px;
			}
			
			
			
			/*loading bars no rounded corners*/
			* {
				border-radius: 0 !important;
			}
		</style>
		
		
		
		<!--MAIN SCRIPT-->
		<script src="static/default_status.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			$SCRIPT_ROOT = "";
			
			(function(i, s, o, g, r, a, m) {
					i['GoogleAnalyticsObject'] = r;
					i[r] = i[r] || function() {
							(i[r].q = i[r].q || []).push(arguments)
					}
					,
					i[r].l = 1 * new Date();
					a = s.createElement(o),
					m = s.getElementsByTagName(o)[0];
					a.async = 1;
					a.src = g;
					m.parentNode.insertBefore(a, m)
			}
			)(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
			ga('create', 'UA-76502811-2', 'auto');
			ga('send', 'pageview');
			
			var map;
			var markers = [];
			
			/**
			 * Converts decimal degrees to degrees minutes seconds.
			 *
			 * @param dd the decimal degrees value.
			 * @param isLng specifies whether the decimal degrees value is a longitude.
			 * @return degrees minutes seconds string in the format 49°15'51.35"N
			 */
			function convertToDms(dd, isLng) {
				var dir = dd < 0 ? isLng ? 'W' : 'S' : isLng ? 'E' : 'N';
				
				var absDd = Math.abs(dd);
				var deg = absDd | 0;
				var frac = absDd - deg;
				var min = (frac * 60) | 0;
				var sec = frac * 3600 - min * 60;
				// Round it to 2 decimal points.
				sec = Math.round(sec * 100) / 100;
				return deg + "°" + min + "'" + sec + '"' + dir;
			}
			
			function generateProgressBarBig(amount, coalition) {
				//coalition = 0;		//test cases
				switch (coalition) {
					case 1:
						return " <div class='progress' style='position: relative; width:30px;height:10px; display:inline-block;margin:0; background: #404040'><div class='progress-bar' style='width: " + amount + "%; background: #ff2e00'> </div> <div style='color: #ffffff; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 9px; padding: 1px; text-align: center; width: 100%'>" + amount + "</div></div> ";
						break;
					case 2:
						return " <div class='progress' style='position: relative; width:30px;height:10px; display:inline-block;margin:0; background: #404040'><div class='progress-bar' style='width: " + amount + "%; background: #00b8ff'> </div> <div style='color: #ffffff; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 9px; padding: 1px; text-align: center; width: 100%'>" + amount + "</div></div> ";
						break;
					default:
						return " <div class='progress' style='position: relative; width:30px;height:10px; display:inline-block;margin:0; background: #404040'><div class='progress-bar' style='width: " + amount + "%; background: #cccccc'> </div> <div style='color: #000; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 9px; padding: 1px; text-align: center; width: 100%'>" + amount + "</div></div> ";
						break;
				}
			}
			
			function generateProgressBarSmall(amount, coalition) {
				switch (coalition) {
					case 1:
						return "<div class='progress' style='position: relative; width:20px; height:7px; display:inline-block; margin-left: 3px; margin-top: 4.5px; margin-right: 0px; margin-bottom: 0px; background: #404040; float: left'><div class='progress-bar' style='width: " + amount + "%; background: #ff2e00'></div></div><div style='color: #ffffff; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 8px; padding-top: 3px; padding-left: 15px; text-align: center; width: 100%'>" + amount + "</div>";
						break;
					case 2:
						return "<div class='progress' style='position: relative; width:20px; height:7px; display:inline-block; margin-left: 3px; margin-top: 4.5px; margin-right: 0px; margin-bottom: 0px; background: #404040; float: left'><div class='progress-bar' style='width: " + amount + "%; background: #00b8ff'></div></div><div style='color: #ffffff; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 8px; padding-top: 3px; padding-left: 15px; text-align: center; width: 100%'>" + amount + "</div>";
						break;
					default:
						return "<div class='progress' style='position: relative; width:20px; height:7px; display:inline-block; margin-left: 3px; margin-top: 4.5px; margin-right: 0px; margin-bottom: 0px; background: #404040; float: left'><div class='progress-bar' style='width: " + amount + "%; background: #cccccc'></div></div><div style='color: #000; text-shadow: #000000; position: absolute; top: 0; left: 0; font-size: 8px; padding-top: 3px; padding-left: 15px; text-align: center; width: 100%'>" + amount + "</div>";
						break;
				}
			}
			
			// Converts from degrees to radians.
			Math.radians = function(degrees) {
				return degrees * Math.PI / 180;
			};
			
			// Converts from radians to degrees.
			Math.degrees = function(radians) {
				return radians * 180 / Math.PI;
			};
			
			function projectToMap(phi, lambda) {		//latitude, longitude
				phi = Math.radians(phi);
				lambda = Math.radians(lambda);
				
				var x = 0;
				var y = 0;
				var scalex = 7440;									//Number(document.getElementById("xscale").innerHTML);		//scale constant -not sure why we need two of them
				var scaley = 7800;									//Number(document.getElementById("yscale").innerHTML);		//scale constant
				var angle = Math.radians(-2.7);			//Math.radians(Number(document.getElementById("rot").innerHTML));
				
				var phi0 = Math.radians(45.2);		//reference latitude		-top left corner of the map
				var lambda0 = Math.radians(37.05);	//reference longitude
				
				var phi1 = Math.radians(41.33333333);		//standard parallel 1		--written on the map
				var phi2 = Math.radians(46.66666666);		//standard parallel 2
				
				var ro;
				var ro0;
				var n;
				var F;
				
				n = Math.log(Math.cos(phi1)*(1/Math.cos(phi2))) / Math.log(Math.tan(Math.PI/4+phi2/2)*(1/Math.tan(Math.PI/4+phi1/2)));
				F = (Math.cos(phi1)*Math.pow(Math.tan(Math.PI/4 + phi1/2), n)) / n;
				ro =  F * Math.pow(1/Math.tan(Math.PI/4+phi/2), n);
				ro0 = F * Math.pow(1/Math.tan(Math.PI/4+phi0/2), n);
				
				x = ro * Math.sin(n*(lambda - lambda0));
				y = ro0 - ro * Math.cos(n*(lambda - lambda0));
				
				x *= scalex;
				y *= scaley;
				
				x = x * Math.cos(angle) - y* Math.sin(angle);
				y = x * Math.sin(angle) + y* Math.cos(angle);
				
				return [x, y];
			}
			
			
			
			function processSessionTime(time) {
				$sessiontimer.text(toHHMMSS(time));
				var percent = time / (180 * 60) * 100
				$sessiontimerbar.css({
						width: percent + '%'
				});
			}
			
			function processBFStatus(first) {
				var fireicon = '<span class="glyphicon glyphicon-fire"> </span>';
				var closedicon = '<span class="glyphicon glyphicon-remove"> </span>';
				var repairicon = '<span class="glyphicon glyphicon-wrench"> </span>';
				var planeicon = '<span class="glyphicon glyphicon-plane"> </span>';
				
				var farps = $('#jsonfarps');
				var comms = $('#jsoncomms');
				var airbases = $('#jsonbases');
				var cities = $('#jsoncities');
				
				farps.text('');
				comms.text('');
				airbases.text('');
				cities.text('');
				
				$livestimer.text(toHHMMSS(BF_STATUS.livesReset))
				
				if (!first) {
					processSessionTime(BF_STATUS.roundTime);
				}
				
				document.getElementById("map").innerHTML = "<img onClick='requestFullScreen(document.body)' src='static/img/map.png' style='width: 800px;'>";
				
				for (var key in BF_STATUS.baseStatus) {
					if (BF_STATUS.baseStatus.hasOwnProperty(key)) {
						var val = BF_STATUS.baseStatus[key];
						
						
						
						var text = '';
						text += val.name + " - PAK " + val.pak + "\n";
						text += val.baseType + "\n";
						text += convertToDms(val.locationDetails.lat) + ", " + convertToDms(val.locationDetails.lon, true) + "\nDD: " + (val.locationDetails.lat.toFixed(4)) + ", " + (val.locationDetails.lon.toFixed(4)) + "\n" + val.locationDetails.mgrs + "\n";
						text += "Health: " + val.health + "%" + "\n";
						
						/*text += "\nCapturable: " + val.capturable + "\n";
						text += "Closed: " + val.closed + "\n";
						text += "Coalition: " + val.coalition + "\n";
						text += "Dead count: " + val.deadCount + "\n";
						if (val.deadCount > 0) {
							text += "---Dead units:---\n";
							Object.keys(val.deadUnits).forEach(function (unitName) {
								text += val.deadUnits[unitName].type + "\n";
							});
							text += "---------------------\n";
						}
						text += "Defenders spawned: " + val.defendersSpawned + "\n";
						text += "Disabled: " + val.disabled + "\n";
						text += "Fuel: " + val.fuel + "kg" + "\n";
						text += "Fuel group alive: " + val.fuelGroupAlive + "\n";
						text += "Has fuel group: " + val.hasFuelGroup + "\n";
						text += "Unit count: " + val.unitCount;*/
						
						
						
						var icon = "static/img/redcity.png"
						var statusInfo = $("<li></li>")
						
						var pos = projectToMap(val.locationDetails.lat, val.locationDetails.lon);
						
						var mapMarker = $("<div style='position: absolute; left: " + (pos[0] - 8) + "px; top: " + (-pos[1] - 7) + "px; padding: 0; width: 39px'></div>");
						var mapIcon = $("<img style='display: block; margin: -10px; padding: 10px; float: left'>");
						
						mapMarker.append(mapIcon);
						statusInfo.append(generateProgressBarBig(val.health, val.coalition));
						statusInfo.append(val.name + ' ');
						
						mapMarker.append(generateProgressBarSmall(val.health, val.coalition));
						
						mapMarkerP = $("<div style='font-size: 8px; color: #ffffff; text-align: center; width: 100%; float: left'></div>");
						
						
						
						var current;
						if (val.baseType == "FARP") {
							if (val.coalition == 1) {
								icon = "static/img/redfarp.png";
							} else {
								icon = "static/img/bluefarp.png";
							}
							current = farps;
						}
						else if (val.baseType == "AIRBASE") {
							if (val.coalition == 1) {
								icon = "static/img/redbase.png";
							} else {
								icon = "static/img/bluebase.png";
							}
							current = airbases;
						}
						else if (val.baseType == "ROADBASE" || val.baseType == "ROAD BASE") {
							if (val.coalition == 1) {
								icon = "static/img/redbase.png";
							} else {
								icon = "static/img/bluebase.png";
							}
							current = farps;
						}
						else if (val.baseType == "COMMS ARRAY" || val.baseType == "COMMSARRAY" || val.baseType == "SAMBASE" || val.baseType == "SAM BASE" || val.baseType == "SAMSITE") {
							if (val.coalition == 1) {
								icon = "static/img/redradar.png";
							} else {
								icon = "static/img/blueradar.png";
							}
							current = comms;
						}
						else {
							if (val.coalition == 1) {
								icon = "static/img/redcity.png";
							} else {
								icon = "static/img/bluecity.png";
							}
							current = cities;
						}
						
						
						
						var imgmap = $('<img>');
						imgmap.attr('src', icon);
						mapIcon.attr('src', icon);
						
						
						
						if (val.closed || val.coalition == 0) {
							if (val.coalition == 0) {
								imgmap.css({
									"-webkit-filter": " grayscale(100%)"
								});
								imgmap.css({
									"filter": " grayscale(100%)"
								});
								mapIcon.css({
									"-webkit-filter": " grayscale(100%)"
								});
								mapIcon.css({
									"filter": " grayscale(100%)"
								});
							}
							else {
								imgmap.css({
									"-webkit-filter": " grayscale(40%)"
								});
								imgmap.css({
									"filter": " grayscale(40%)"
								});
								mapIcon.css({
									"-webkit-filter": " grayscale(40%)"
								});
								mapIcon.css({
									"filter": " grayscale(40%)"
								});
							}
							
							statusInfo.css({color: 'gray'});
							if (val.closed) {
								statusInfo.append(closedicon);
							}
						}
						
						
						
						statusInfo.prepend(imgmap);
						
						
						if (val.underAttack) {
							mapIcon.css("background-repeat", "no-repeat");
							mapIcon.css("background-position", "center");
							mapIcon.css("background-image", "url('static/img/circle.png')");
							
							statusInfo.css({color: 'orange'});
							mapMarkerP.css({color: 'orange'});
							
							statusInfo.append(fireicon);
							mapMarkerP.append(fireicon);
						}
						
						if (val.repairing) {
							statusInfo.append(repairicon);
							mapMarkerP.append(repairicon);
						}
						
						if (val.ewrDetected) {
							statusInfo.append(planeicon);
							mapMarkerP.append(planeicon);
						}
						
						
						
						statusInfo.tooltip({
							title: text,
							placement: 'auto',
							animation: false
						});
						
						mapMarker.tooltip({
							title: text,
							placement: 'auto',
							animation: false
						});
						
						mapMarker.append(mapMarkerP);
						
						//place the inflated views
						current.append(statusInfo);
						$('#map').append(mapMarker);
					}
				}
				
				
				processLivesConfig();
			}
			
			function createInfoWindow(baseInfo) {
				var blue = new Map();
				var red = new Map();
				var content = "<br /><br />"
				
				if (baseInfo.clientSlotsByUnitId != undefined && baseInfo.clientSlotsByUnitId != null) {
					for (var key in baseInfo.clientSlotsByUnitId) {
						if (baseInfo.clientSlotsByUnitId.hasOwnProperty(key)) {
							var slot = baseInfo.clientSlotsByUnitId[key];
							
							var unitMap
							if (slot.coalition === "red") {
								unitMap = red;
							}
							else {
								unitMap = blue;
							}
							
							if (unitMap.has(slot.type)) {
								unitMap.set(slot.type, unitMap.get(slot.type) + 1);
							}
							else {
								unitMap.set(slot.type, 1);
							}
						}
					}
				}
				
				if (red.size > 0) {
					content += "Red:<br/>";
					
					content += "<ul>";
					
					red.forEach(function(value, key) {
						content += ("<li>" + key + ": " + value + "</li>");
					});
					
					content += "</ul>";
				}
				
				if (blue.size > 0) {
					content += "Blue:<br/>";
					content += "<ul>";
					
					blue.forEach(function(value, key) {
						content += ("<li>" + key + ": " + value + "</li>");
					});
					
					content += "</ul>";
				}
				
				if (red.size > 0 || blue.size > 0) {
					return content;
				}
				return "";
			}
			
			function processLivesConfig() {
				var config = BF_STATUS.livesConfig;
				
				$('#lives-config').text('');
				$('#lives-config').append("<p>STANDARD: " + config.standard + "</p>");
				
				for (var key in config) {
					if (config.hasOwnProperty(key)) {
						if (key != 'standard') {
							var lives = config[key];
							var str = "<p>" + key.toUpperCase() + " -  " + lives.lives + ": ";
							
							for (var i = 0; i < lives.type.length; ++i) {
								str = str + lives.type[i] + " ";
							}
							str = str + "</p>";
							$('#lives-config').append(str);
						}
					}
				}
			}
			
			
			
			var loadandstuff = function (){
				//Check if we want to display the kneeboard
				var loc = (document.location + '').split("?");
				if (loc[loc.length - 1] == "knee") {
					$('#kneeboard').css("display", "block");
				}
				
				//process BF_status for the first time
				processBFStatus(true);
				
				
				var $MASTER_LIVE_SERVER = false;
				
				
				//crete data connection
				var ws = io.connect('http://gadget.buddyspike.net:80');		//io.connect('http://' + document.domain + ':' + location.port);
				
				ws.on('connect', function() {
					ws.emit('connect event', JSON.stringify({
						'data': 'client connected'
					}));
					$status.text('connected');
					$status.removeClass("label-danger label-warning").addClass("label label-primary");
				});
				
				ws.on('disconnect', function() {
					$status.text('disconnected');
					$status.removeClass("label-warning label-primary").addClass("label label-danger");
				});
				
				ws.on('error', function() {
					$status.text('error');
					$status.removeClass("label-danger label-primary").addClass("label label-warning");
				});
				
				ws.on('dcs server status emited', function(msg) {
					console.log('server is alive: ' + msg.data);
					$servericon.tooltip({
						title: '░▒▓ BUDDYSPIKE™ www.blix.com ▓▒░',
						placement: 'left',
						animation: false
					});
					$MASTER_LIVE_SERVER = msg.data;
					if (msg.data) {
						$servericon.attr('src', '/static/img/logo-blix.png');
						$jsonpilots.fadeIn("slow");
						$sessiontimerlabel.fadeIn("slow");
						$sessiontimer.fadeIn("slow");
						$sessiontimerbar_parent.fadeIn("slow");
					}
					else {
						$servericon.attr('src', '/static/img/logo-blix-grey.png');
						$jsonpilots.fadeOut("slow");
						$sessiontimerlabel.fadeOut("slow");
						$sessiontimer.fadeOut("slow");
						$sessiontimerbar_parent.fadeOut("slow");
						$pilotsonlinecounter.text('server offline');
					}
				});
				
				ws.on('time emited', function(msg) {
					console.log(msg);
					ga('send', {
						hitType: 'event',
						eventCategory: 'xhrpush',
						eventAction: 'refresh',
					});
					$updatetime.text(msg.data);
				});
				
				ws.on('jsonpilots emited', function(jmsg) {
					var arr = JSON.parse(jmsg);
					var red_pilots = new Array();
					var blue_pilots = new Array();
					var gray_pilots = new Array();
					var radioicon = '<span style="color:orange" class="glyphicon glyphicon-headphones"> </span>';
					var eyeicon = '<span style="color:orange" class="glyphicon glyphicon glyphicon-eye-open"> </span>';
					
					$.each(arr, function(i, obj) {
						if (obj.side == 1) {
							red_pilots.push([obj.name, obj.radio, obj.ping, obj.nextreset, obj.radiounittype, obj.frequencystring]);
						}
						else if (obj.side == 2) {
							blue_pilots.push([obj.name, obj.radio, obj.ping, obj.nextreset, obj.radiounittype, obj.frequencystring]);
						}
						else if (obj.side === 0) {
							gray_pilots.push([obj.name, obj.radio, obj.ping, obj.nextreset, obj.radiounittype, obj.frequencystring]);
						}
					});
					
					$jsonpilots.text('');
					$.each(red_pilots.sort(), function(i, item) {
						var txt1 = $("<li></li>").text(item[0] + ' ');
						
						if (item[1] == 1) {
							txt1.addClass("reddot");
							txt1.append(radioicon);
						}
						else {
							txt1.addClass("reddot");
						}
						
						if (item[4] == '\nIn: CA') {
							txt1.append('&nbsp;');
							txt1.append(eyeicon);
						}
						
						var tooltext = item[0] + '\nPing: ' + item[2] + item[4] + '\n' + item[5];
						
						txt1.tooltip({
							title: tooltext,
							placement: 'top',
							animation: false
						});
						
						$jsonpilots.append(txt1);
					});
					
					$.each(blue_pilots.sort(), function(i, item) {
						var txt1 = $("<li></li>").text(item[0] + ' ');
						
						if (item[1] == 1) {
							txt1.addClass("bluedot");
							txt1.append(radioicon);
						}
						else {
							txt1.addClass("bluedot");
						}
						
						if (item[4] == '\nIn: CA') {
							txt1.append('&nbsp;');
							txt1.append(eyeicon);
						}
						
						var tooltext = item[0] + '\nPing: ' + item[2] + item[4] + '\n' + item[5];
						txt1.tooltip({
							title: tooltext,
							placement: 'top',
							animation: false
						});
						
						$jsonpilots.append(txt1);
					});
					
					$.each(gray_pilots.sort(), function(i, item) {
						var txt1 = $("<li></li>").text(item[0] + ' ');
						
						if (item[1] == 1) {
							txt1.addClass("neutraldot");
							txt1.append(radioicon);
						}
						else {
							txt1.addClass("neutraldot");
						}
						
						if (item[4] == '\nIn: CA') {
							txt1.append('&nbsp;');
							txt1.append(eyeicon);
						}
						
						var tooltext = item[0] + '\nPing: ' + item[2] + item[4] + '\n' + item[5];
						
						txt1.tooltip({
							title: tooltext,
							placement: 'top',
							animation: false
						});
						
						$jsonpilots.append(txt1);
					});
					
					var totalpilots = blue_pilots.length + red_pilots.length + gray_pilots.length;
					
					if (totalpilots < 0) {
						totalpilots = 0;
					}
					
					var pilotcountertext = '';
					
					if ($MASTER_LIVE_SERVER) {
						if (totalpilots == 0) {
							pilotcountertext = 'server online';
						} else if (totalpilots == 1) {
							pilotcountertext = 'one loner online';
						} else {
							pilotcountertext = totalpilots + ' pilots online <span style="color:#00aef0; font-size:1.5em">' + blue_pilots.length + '</span> vs <span style="color:#ff2d03; font-size:1.5em">' + red_pilots.length + '</span>';
						}
					}
					else {
							pilotcountertext = 'server offline';
					}
					
					$pilotsonlinecounter.html(pilotcountertext);
					
					if (totalpilots > 30 && $MASTER_LIVE_SERVER == true) {
							$pilotslogo.fadeOut("slow");
					}
					else {
							$pilotslogo.fadeIn("slow");
					}
				});
				
				ws.on('bfstatus emited', function(jmsg) {
					BF_STATUS = jmsg;
					processBFStatus(false);
				});
				
				ws.on('bfpilots emited', function(jmsg) {
					document.getElementById("mystatus").innerHTML = "bfpilots emited";
					
					$('#total-red').text(jmsg.red + " RED");
					$('#total-blue').text(jmsg.blue + " BLUE");
				});
				
				ws.on('alert emited', function(jmsg) {
					var obj = JSON.parse(jmsg);
					$alerttit.html('<a href="' + obj.url + '" target="_blank">' + obj.title + '</a>').html();
					$alertbody.text(obj.body);
				});
				
				ws.on('stats emited', function(jmsg) {
					var arr = JSON.parse(jmsg);
					
					$statit.text('');
					$.each(arr, function(i, obj) {
						console.log(obj[0]);
						var txt1 = $("<li></li>").text(obj[0].name + ' ');
						if (obj[0].side == 'blue') {
							txt1.addClass("bluedot");
						} else if (obj[0].side == 'red') {
							txt1.addClass("reddot");
						}
						var tooltext = 'Sorties: ' + (obj.length + 1)
						tooltext = tooltext + '\nKills: ' + obj[0].kills.length;
						txt1.tooltip({
							title: tooltext,
							placement: 'top',
							animation: false
						});
						$statit.append(txt1);
					});
				});
			}
			
			$(document).ready(loadandstuff);
			
			
			
			function myFunction(pilotname) {
				if (pilotname == null) {
					var pilotname = document.getElementById("list_players").value;
				}
				var ucid;
				for (var key in allPilotArr) {
					if (pilotname == allPilotArr[key].name) {
						ucid = key;
					}
				}
				console.log(ucid);
				pilotsoverview(ucid);
				pilotkills(ucid);
				currentstreak(ucid);
				beststreak(ucid);
				flighttime(ucid);
				pilotinfo(ucid);
			}
			function checkpilotside(_ucid) {
				for (var key in allPilotArr) {
					if (_ucid == key) {
						if (allPilotArr[key].side == 'blue') {
							return 'blue';
						}
						else if (allPilotArr[key].side == 'red') {
							return 'red';
						}
						else {
							return 'grey';
						}
					}
				}
				return '';
			}
			function getallpilots() {
				$.getJSON(pilotsurl, function(json) {
					$.each(json.pilotlist, function(i, v) {
						allPilotArr[v[0]] = {
							"name": v[1],
							"side": v[2]
						};
					});
				});
				console.log(allPilotArr);
			}
			function test(ucid) {
				console.log(ucid);
				$.getJSON($SCRIPT_ROOT + '/statistics/' + ucid, function(data) {
					console.log(data);
				});
			}
			function pilotsoverview(_ucid) {
				if (_ucid == null) {
					$("#pilotsArr tr").remove();
					$.getJSON($SCRIPT_ROOT + '/statistics', function(data) {
						$.each(data.resultlist3, function(i, item) {
							var side = checkpilotside(item[0])
							var tabrow = $('<tr></tr>');
							
							var namecell = $('<td style="padding-left: 20px;"></td>');
							if (side == 'blue') {
								namecell.addClass("bluedot");
							}
							else if (side == 'red') {
								namecell.addClass("reddot");
							}
							var sortiecell = $("<td></td>");
							var gkillcell = $("<td></td>");
							var akillcell = $("<td></td>");
							var tkillcell = $("<td></td>");
							var landcell = $("<td></td>");
							var deathcell = $("<td></td>");
							var aakdcell = $("<td></td>");
							var agkdcell = $("<td></td>");
							var kdcell = $("<td></td>");
							var skdcell = $("<td></td>");
							var slcell = $("<td></td>");
							
							tabrow.append(namecell.text(item[1]));
							tabrow.append(sortiecell.text(item[2]));
							tabrow.append(gkillcell.text(item[3]));
							tabrow.append(akillcell.text(item[4]));
							tabrow.append(tkillcell.text(item[5]));
							tabrow.append(landcell.text(item[6]));
							tabrow.append(deathcell.text(item[7]));
							tabrow.append(aakdcell.text(item[8]));
							tabrow.append(agkdcell.text(item[9]));
							tabrow.append(kdcell.text(item[10]));
							tabrow.append(skdcell.text(item[11]));
							tabrow.append(slcell.text(item[12]));
							
							// tabrow.append(freqcell.text(item[6]));
							$pilotsArr.append(tabrow);
						});
					}).complete(function() {
						var pinfotable = $('#pilotsOverview').DataTable();
						$('#pilotsOverview tbody').on('click', 'tr', function() {
							var data = pinfotable.row(this).data();
							console.log(data[0]);
							myFunction(data[0]);
						});
					});
				}
				else {
					$("#pilotArr tr").remove();
					$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid, function(data) {
						var tabrow = $("<tr></tr>");
						$.each(data.resultlist1[0], function(i, item) {
								var cell = $("<td></td>");
								tabrow.append(cell.text(item));
								console.log(item)
						});
						$pilotArr.append(tabrow);
						for (var key in allPilotArr) {
							if (_ucid == key) {
								if (allPilotArr[key].side == 'blue') {
									pilotnameText = '<span style="color:#00aef0">' + allPilotArr[key].name + '</span>';
									$pilotname.html(pilotnameText);
								}
								else {
									pilotnameText = '<span style="color:#ff2d03">' + allPilotArr[key].name + '</span>';
									$pilotname.html(pilotnameText);
								}
							}
						}
					});
				}
			}
			function pilotinfo(_ucid) {
				if ($.fn.DataTable.isDataTable("#pilotInfo")) {
					$("#pilotInfo").DataTable().clear().destroy();
				}
				
				flightinfoArr = {};
				
				$("#pilotInfoArr tr").remove();
				$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid + '/info', function(data) {
					$.each(data.resultlist2, function(i, item) {
						var tabrow = $("<tr></tr>");

						var flightfkcell = $("<td></td>");
						var takeoffcell = $("<td></td>");
						var endtimecell = $("<td></td>");
						var endeventcell = $("<td></td>");
						var sidecell = $("<td></td>");
						var killscell = $("<td></td>");
						var typecell = $("<td></td>");

						tabrow.append(flightfkcell.text(item[0]));
						tabrow.append(takeoffcell.text(item[1]));
						tabrow.append(endtimecell.text(item[2]));
						tabrow.append(endeventcell.text(item[3]));
						tabrow.append(sidecell.text(item[4]));
						tabrow.append(killscell.text(item[5]));
						tabrow.append(typecell.text(item[6]));

						flightinfoArr[i] = [];
						for (var idx in item) {
							flightinfoArr[i].push(item[idx]);
						}
						// tabrow.append(freqcell.text(item[6]));
						$pilotInfoArr.append(tabrow);
					});
					console.log(flightinfoArr);
				}).complete(function() {
					infotable = $("#pilotInfo").dataTable();
					document.getElementById("pinfo").click();
				});
			}
			function pilotkills(_ucid) {
				if ($.fn.DataTable.isDataTable("#pilotKills")) {
					$("#pilotKills").DataTable().clear().destroy();
				}
				
				$("#pilotKillsArr tr").remove();
				$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid + '/kills', function(data) {
					$.each(data.resultlist4, function(i, item) {
						var tabrow = $("<tr></tr>");
						
						var flightfkcell = $("<td></td>");
						var killtimecell = $("<td></td>");
						var killersidecell = $("<td></td>");
						var killerunitcell = $("<td></td>");
						var victimnamecell = $("<td></td>");
						var victimsidecell = $("<td></td>");
						var victimunitcell = $("<td></td>");
						var weaponcell = $("<td></td>");
						
						tabrow.append(flightfkcell.text(item[0]));
						tabrow.append(killtimecell.text(item[1]));
						tabrow.append(killersidecell.text(item[2]));
						tabrow.append(killerunitcell.text(item[3]));
						tabrow.append(victimnamecell.text(item[4]));
						tabrow.append(victimsidecell.text(item[5]));
						tabrow.append(victimunitcell.text(item[6]));
						tabrow.append(weaponcell.text(item[7]));
						
						// tabrow.append(freqcell.text(item[6]));
						$pilotKillsArr.append(tabrow);
					});
				}).complete(function() {
					infotable = $("#pilotKills").dataTable();
				});
			}
			function beststreak(_ucid) {
				var result;
				$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid + '/beststreak', function(data) {
					if (data.resultlist6.length == 0) {
						result = 0;
					}
					else {
						console.log(data.resultlist6[0][0]);
						result = data.resultlist6[0][0];
					}
				}).complete(function() {
					<!-- console.log(result) -->
					for (var key in allPilotArr) {
						if (_ucid == key) {
							if (allPilotArr[key].side == 'blue') {
								bestStreakText = 'Best Streak: <span style="color:#00aef0">' + result + '</span>';
								$bestStreak.html(bestStreakText);
							}
							else {
								bestStreakText = 'Best Streak: <span style="color:#ff2d03">' + result + '</span>';
								$bestStreak.html(bestStreakText);
							}
						}
					}
				});
			}
			function currentstreak(_ucid) {
				var result;
				$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid + '/currentstreak', function(data) {
					if (data.resultlist7.length == 0) {
						result = 0;
					}
					else {
						console.log(data.resultlist7[0][0]);
						result = data.resultlist7[0][0];
					}
				}).complete(function() {
					<!-- console.log(result) -->
					for (var key in allPilotArr) {
						if (_ucid == key) {
							if (allPilotArr[key].side == 'blue') {
								currentStreakText = 'Current Streak: <span style="color:#00aef0">' + result + '</span>';
								$currentStreak.html(currentStreakText);
							}
							else {
								currentStreakText = 'Current Streak: <span style="color:#ff2d03">' + result + '</span>';
								$currentStreak.html(currentStreakText);
							}
						}
					}
				});
			}
			function flighttime(_ucid) {
				var result;
				$.getJSON($SCRIPT_ROOT + '/statistics/' + _ucid + '/flighttime', function(data) {
					if (data.resultlist8.length == 0) {
						result = 0;
					}
					else {
						console.log(data.resultlist8[0][0]);
						result = data.resultlist8[0][0];
					}
				}).complete(function() {
					<!-- console.log(result) -->
					for (var key in allPilotArr) {
						if (_ucid == key) {
							if (allPilotArr[key].side == 'blue') {
								flighttimeText = 'Flight Time: <span style="color:#00aef0">' + result + '</span>';
								$flighttime.html(flighttimeText);
							} else {
								flighttimeText = 'Flight Time: <span style="color:#ff2d03">' + result + '</span>';
								$flighttime.html(flighttimeText);
							}
						}
					}
				});
			}
		</script>
		
		
		
		<style type="text/css" data-styled-components="" data-styled-components-is-local="true"></style>
	</head>
	
	
	
	<body>
		<!--HEADER-->
		<div id="header">
			<span id="mystatus" style="display: none">none</span>
			
			<!--TEST projection constants-->
			<!--button onclick="document.getElementById('xscale').innerHTML = Number(document.getElementById('xscale').innerHTML) - 10; processBFStatus(false);">-10</button>
			<span id="xscale">7300</span>
			<button onclick="document.getElementById('xscale').innerHTML = Number(document.getElementById('xscale').innerHTML) + 10; processBFStatus(false);">+10</button>
			<button onclick="document.getElementById('yscale').innerHTML = Number(document.getElementById('yscale').innerHTML) - 10; processBFStatus(false);">-10</button>
			<span id="yscale">7800</span>
			<button onclick="document.getElementById('yscale').innerHTML = Number(document.getElementById('yscale').innerHTML) + 10; processBFStatus(false);">+10</button>
			<button onclick="document.getElementById('rot').innerHTML = Number(document.getElementById('rot').innerHTML) - 0.1; processBFStatus(false);">-0.1</button>
			<span id="rot">-2</span>
			<button onclick="document.getElementById('rot').innerHTML = Number(document.getElementById('rot').innerHTML) + 0.1; processBFStatus(false);">+0.1</button-->
			
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last update:&nbsp;
			<span class="label label-default" style="font-size: 14px; width:auto;" id="updatetime">&nbsp;&nbsp;&nbsp;&nbsp;</span>
			<span>while: </span>
			<span style="font-size: 14px;" id="status" class="label label-primary">connecting...</span>
		</div>
		
		<!--content container-->
		<div id="contentContainer">
			<div id="map"></div><br>
			
			<table id="mainContent">
				<tr>
					<td>
						 <!-- PILOTS -->
						<!------------------------------------------------------------------------------ -->
						<div style="width:200px">
							<h5><b><span id="sessiontimerlabel" style="color:grey">session elapsed time: </span></h5><h3><span id="sessiontimer" style="color:white">LOADING</span></b></h3>
							<div class="progress progress-striped active" id="sessiontimerbar_parent">
								<div class="progress-bar" style="width: 72.2222%;" id="sessiontimerbar"></div>
							</div>
							<h6><span id="pilotsonlinecounter" style="color:grey">&nbsp;</span></h6>
							
							<hr>
							<p>
								<span style="color:gray">time to lives reset </span><span class="label label-default" id="livestimer">00:00:00</span>
							</p>
							<p>DCS Radio IP <span class="label label-danger">54.36.126.186:5014</span></p>
							<p>Teamspeak pass <span class="label label-primary">RayGun</span></p>
							<p>Registered: <span id="total-red" class="label label-danger">0 RED</span> <span id="total-blue" class="label label-primary">0 BLUE</span></p>
						</div>
					</td>
					<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td>
						<!-- AIRBASES and Roadbases -->
						<!------------------------------------------------------------------------------ -->
						<div class="basesList">
							<h5 class="text-left">Airfields</h5>
							<ul class="no_bullet text-left bsspacing" id="jsonbases"></ul>
						</div>
					</td>
					<td>
						<!-- FARPS plus COMMS-->
						<!------------------------------------------------------------------------------ -->
						<div class="basesList">
							<div>
								<h5>Farps &amp; Road Bases</h5>
								<ul class="no_bullet text-left bsspacing" id="jsonfarps"></ul>
							</div>
						</div>
					</td>
					<td>
						<!-- CITIES -->
						<!------------------------------------------------------------------------------ -->
						<div class="basesList">
							<div>
								<h5>Cities &amp; Fuel Bases</h5>
								<ul class="no_bullet text-left bsspacing" id="jsoncities"></ul>
								<h5>Comm Arrays &amp; Sam Sites</h5>
								<ul class="no_bullet text-left bsspacing" id="jsoncomms"></ul>
							</div>
						</div>
					</td>
				</tr>
			</table>
			<!-- INFO -->
			<!------------------------------------------------------------------------------ -->
			<div style="margin: 0 auto">
				<div id="myTabContent" class="tab-content">
					<div class="tab-pane fade active in" id="stuff">
						<br>
						<p><span class="glyphicon glyphicon-fire"> </span> Base is under attack |
							<span class="glyphicon glyphicon-remove"> </span> closed |
							<span class="glyphicon glyphicon-wrench"> </span> repairing |
							<span class="glyphicon glyphicon-plane"> </span> has active interceptors.<br>
							<span class="glyphicon glyphicon-info-sign"> </span> You can mouse over things to get
							coordinates.<br>
							<span class="glyphicon glyphicon-info-sign"> </span> If the server is not shown in the
							2.5 server list, the IP is 54.36.126.186:10310.<br>
							<span class="glyphicon glyphicon-exclamation-sign"> </span> This page will auto refresh,
							no need to mash the F5 key to get up-to-date results.<br><span class="glyphicon glyphicon-fullscreen"> </span>&nbsp;Click the map to go fullscreen.</p>
					</div>
				</div>
			</div>
			<!------------------------------------------------------------------------------ -->
			
			<br><iframe id="kneeboard" src="knee.html" style="width: 100%; height: 1500px; border: #000; display: none;"></iframe>
		</div>
		
		
		
		<!--SECONDARY SCRIPT, not sure why-->
		<script type="text/javascript" charset="UTF-8">
			function requestFullScreen(el) {
				// Supports most browsers and their versions.
				var requestMethod = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullScreen;
				if (requestMethod) {
					// Native full screen.
					requestMethod.call(el);
				}
				else if (typeof window.ActiveXObject !== "undefined") {
					// Older IE.
					var wscript = new ActiveXObject("WScript.Shell");
					if (wscript !== null) {
						wscript.SendKeys("{F11}");
					}
				}
			}
			
			var pilotdataurl = 'http://' + document.domain + ':' + location.port + '/radiolistdata';
			var fueldataurl = 'http://' + document.domain + ':' + location.port + '/fueldata';
			var chartdataurl = 'http://' + document.domain + ':' + location.port + '/chartdata';
			var statsurl = 'http://' + document.domain + ':' + location.port + '/get_stats';
			var pilotsurl = 'http://' + document.domain + ':' + location.port + '/list_pilots';

			var redicon = '<span style="color:#ff2d03" class="glyphicon glyphicon-user"> </span>';
			var blueicon = '<span style="color:#00aef0" class="glyphicon glyphicon-user"> </span>';
			var radioicon = '<span style="color:orange" class="glyphicon glyphicon-headphones"> </span>';
			var eyeicon = '<span style="color:orange" class="glyphicon glyphicon glyphicon-eye-open"> </span>';

			var $pilotdetailsR = $('#pilotdetailsR');
			var $pilotdetailsL = $('#pilotdetailsL');
			var $thetableL = $('#thetableL');
			var $thetableR = $('#thetableR');
			var $titledetailL = $('#titledetailL');
			var $titledetailR = $('#titledetailR');
			var $fuelmeters = $('#fuelmeters');
			var $placeholder = $('#placeholder');
			var $pilotArr = $('#pilotArr');
			var $pilotInfoArr = $('#pilotInfoArr');
			var $pilotKillsArr = $('#pilotKillsArr');
			var $pilotsArr = $('#pilotsArr');
			var $currentStreak = $('#currentStreak');
			var $flighttime = $('#flighttime');
			var $pilotname = $('#pilotname');
			var $bestStreak = $('#bestStreak');
			var allPilotArr = new Array();
			var flightinfoArr = [];
			var autocompletelist = new Array();
			
			var pilotchartoptions = {
					yaxis: {
							min: 0
					},
					series: {
							lines: {
									show: true,
									fill: false,
									fillColor: {colors: [{opacity: 0.7}, {opacity: 0.1}]}
							},
							points: {
									show: false,
									radius: 3
							}
					},
					colors: ["#ff2d03", "#00aef0"],
			};
			
			var $status = $('#status');
			var $updatetime = $('#updatetime');
			var $jsonpilots = $('#jsonpilots');
			var $pilotslogo = $('#pilotslogo');
			var $pilotsonlinecounter = $('#pilotsonlinecounter');
			var $alerttit = $('#alerttit');
			var $alertbody = $('#alertbody');
			var $sessiontimer = $('#sessiontimer');
			var $livestimer = $('#livestimer');
			var $sessiontimerlabel = $('#sessiontimerlabel');
			var $sessiontimerbar = $('#sessiontimerbar');
			var $sessiontimerbar_parent = $('#sessiontimerbar_parent');
			var $servericon = $('#servericon');
			var $messageinputform = $('#messageinputform');
			var $messageinputbutton = $('#messageinputbutton');
			
			var toHHMMSS = function (num) {
				var sec_num = parseInt(num, 10); // don't forget the second param
				var hours = Math.floor(sec_num / 3600);
				var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
				var seconds = sec_num - (hours * 3600) - (minutes * 60);
				
				if (hours < 10) {
					hours = "0" + hours;
				}
				if (minutes < 10) {
					minutes = "0" + minutes;
				}
				if (seconds < 10) {
					seconds = "0" + seconds;
				}
				return hours + ':' + minutes + ':' + seconds;
			};
		</script>
	</body>
</html>
